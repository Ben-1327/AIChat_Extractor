# 要件定義書 (最終ドラフト: Mac CLIツール版 - Obsidian Chat View対応)

## 1. プロジェクト概要
- **プロジェクト名**: AI Chat Extractor CLI
- **目的**: Grok/ChatGPT/Gemini/Claudeの共有リンクから会話を自動抽出・Obsidian Chat View対応Markdownとして出力するMac CLIツール。個人用スクレイピングOKで自動HTML取得。設定ファイルでオプション管理、GitHub公開リポジトリでアップデート可能。どのディレクトリからでも実行できるグローバルコマンド化。
- **対象ユーザー**: Macユーザー（個人用AIチャットメモ化）。
- **範囲**: CLIスクリプト。リンク入力→自動HTML取得→抽出→Chat View形式Markdown保存。インストール/アンインストール/アップデート機能統合。

## 2. 機能要件
### 2.1 コア機能
- コマンド形式: chat_extract [url] [options] （url位置引数でシンプル、コマンド名簡単わかりやすい）。
- データ取得: スクレイピングでHTML自動ダウンロード（requests.get）。ToS警告出力（コンソールメッセージ）。
- 会話抽出: BeautifulSoupで解析（サービス別ロジック: URLドメイン自動判別、手動--serviceオプション）。user/AI発言リスト化、重複除去。
- 出力生成: Obsidian Chat View形式（```chat \n {styles from config} \n [colors from config] \n < AI | header | text | subtext (e.g., 日時/順番) \n > user | ... \n # コメント (抽出ログ) \n ...）。整形わかりやすく。
- 保存: 指定/デフォルトフォルダにconversation.md出力。Obsidian Vault対応。

### 2.2 追加機能
- オプション (良い感じに):
  - --output DIR: 出力フォルダ（デフォルト: configファイル）。
  - --config PATH: 設定ファイル（デフォルト: ~/.config/ai_chat_extractor/config.yaml, YAML形式でdefault_output, default_styles: header=h3, max_width=75, colors={user:blue, Grok4:yellow, ...}など）。
  - --service SERVICE: 手動サービス指定（デフォルト: 自動）。
  - --verbose: 詳細ログ出力。
  - --styles STYLE: スタイルオーバーライド（文字列形式 "header=h3,mw=75", デフォルト: config）。
  - --version: バージョン表示。
  - --update: GitHubから自動アップデート（latest releaseフェッチ、バージョン比較、ダウンロード/置き換え。リポジトリ公開前提）。
  - --help: カスタムヘルプメッセージ。
- 設定ファイル: 初回自動生成/初期化（--init不要、実行時チェック）。毎回オプション指定不要。
- エラー処理: コンソールメッセージ/詳細ログ。HTML不正時など。
- インストール: install.shスクリプトで自動（clone後実行: 依存pip install, pyinstallerでバイナリ生成, ~/binコピー, PATH追加）。グローバル実行可能。
- アンインストール: uninstall.shで実行（バイナリ削除, PATH除去, 設定ファイル削除）。

## 3. 非機能要件
- **パフォーマンス**: 実行時間<10秒。
- **セキュリティ**: 個人用ローカル実行。ToSリスク自己責任。
- **対応環境**: Macターミナル、Python 3.10+。ライブラリ: requests, beautifulsoup4, pyyaml, pyinstaller (ビルド用)。
- **出力整形**: プラグイン互換でわかりやすいチャット形式。設定ファイルでカスタム。
- **アップデート**: GitHub API使用（公開リポジトリ前提）。バイナリ自動置き換え。

## 4. 制約と前提
- スクレイピング: 個人用OK、検知回避なし。
- 技術: Pythonスクリプト + argparse + PyYAML + requests (アップデート用)。
- 構造変化: ツールアップデートで対応。
- GitHub: 公開リポジトリでリリース管理。

## 5. 次ステップ
- ER図作成: データフロー図。
- 詳細設計: CLI仕様、install/uninstallスクリプト、コードスニペット。
- プロトタイプ: サンプルスクリプトテスト。
- リポジトリセットアップ: GitHub公開準備。